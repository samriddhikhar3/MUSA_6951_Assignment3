---
title: "Themes and Data Visualizations"
author: "Samriddhi Khare"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
    code_download: true
    theme: journal 
---

## Introduction

Gentrification in the University City District of Philadelphia has been a prominent and complex issue in recent years. This neighborhood, home to institutions like the University of Pennsylvania and Drexel University, has experienced a significant transformation. As these universities have expanded and attracted more students and faculty, it has led to rising property values, increased rental costs, and a changing demographic landscape.

While gentrification has brought investment, improved infrastructure, and revitalization to certain parts of University City, it has also raised concerns about displacement and inequality. Long-time residents, often from lower-income backgrounds, have been pushed out due to escalating housing costs, making it difficult for them to continue living in the area they call home.

This report outlines specific demographic data and changes to highlight changes that have occured in the recent years. 

```{r Setup Knitting Parameters, include=FALSE}
  knitr::opts_chunk$set(
    echo = TRUE,
    warning = FALSE,
    message = FALSE,
    out.width = '100%',
    fig.retina =3
  )
```

## R Setup and Packages 

This code chunk deals with the necessary steps of loading packages that are used later in the script. 

```{r setup_packages, warning = FALSE, message = FALSE}

library(tidyverse)
library(tidycensus)
library(sf)
library(kableExtra)
library(tidyr)
library(ggplot2)
library(viridis)
library(stringr)
library(socviz)
library(extrafont)
library(gridtext)
library(grid)

source("helper_functions.R")
source("theme/theme_swd.R")

options(scipen=999)
options(tigris_class = "sf")

```

## Creating a theme 

The first step is to create a theme to ensure plots look neat and consistent.  

```{r}
theme_sk <- function(base_size = 12, title_size = 16) {
  font <- "sans"
  
  # Create a base theme
  base_theme <- theme_minimal() +
    theme(
      panel.grid.minor = element_blank(),
      axis.ticks = element_blank(),
      axis.title = element_text(family = font, size = 12),
      plot.title = element_text(family = font, size = title_size, color = "black"),
   #   panel.border = element_rect(colour = "grey80", fill = NA, size = 1),
     # plot.background = element_blank(),
      text = element_text(family = font, color = "black"),
      strip.text = element_text(family = font, size = 12),
      strip.background = element_rect(fill = "grey80", color = "white"),
      axis.text = element_text(family = font, size = 10),
      plot.caption = element_text(family = font, hjust = 1),
      panel.grid.major = element_line(colour = "grey80", linetype = "longdash", size = 0.1),
      plot.subtitle = element_text(family = font, colour = "grey50"),
      panel.background = element_blank()
    )
  
}
```


2. From your dataset, create THREE Different types of graphs (they can use different variables). Each graph should have a descriptive title (as in a newspaper lede). It should also have a purpose - there should be something you are trying to communicate about your data very directly. Look for an insight and highlight it.

```{r loading_census, results='hide'}

acs_variable_list <- load_variables(2020, #year
                                         "acs5", #five year ACS estimates
                                         cache = TRUE)

acs_vars <- c("B01001_001E", # ACS total Pop estimate
              "B25002_001E", # Estimate of total housing units
              "B25002_003E", # Number of vacant housing units
              "B19013_001E", # Median HH Income ($)
              "B02001_002E", # People describing themselves as "white alone"
              "B06009_006E") # Total graduate or professional degree

acsTractsPHL.2020 <- get_acs(geography = "tract",
                             year = 2020, 
                             variables = acs_vars,
                             geometry = FALSE,
                             state = "PA", 
                             county = "Philadelphia",
                             output = "wide") %>%
  dplyr::select (GEOID, NAME, all_of(acs_vars)) %>% 
  rename (total_pop.2020 = B01001_001E,
          total_HU.2020 = B25002_001E,
          total_vacant.2020 = B25002_003E,
          med_Income.2020 = B19013_001E,
          total_White.2020 = B02001_002E,
          total_GradDeg.2020 = B06009_006E) %>%
  mutate(vacancyPct.2020 = total_vacant.2020/total_HU.2020,
         pctWhite.2020 = total_White.2020/total_pop.2020)

acsTractsPHL.2016 <- get_acs(geography = "tract",
                             year = 2016, 
                             variables = acs_vars,
                             geometry = FALSE,
                             state = "PA", 
                             county = "Philadelphia",
                             output = "wide") %>%
  dplyr::select (GEOID, NAME, all_of(acs_vars)) %>% 
  rename (total_pop.2016 = B01001_001E,
          total_HU.2016 = B25002_001E,
          total_vacant.2016 = B25002_003E,
          med_HH_Income.2016 = B19013_001E,
          total_White.2016 = B02001_002E,
          total_GradDeg.2016 = B06009_006E) %>%
  mutate(vacancyPct.2016 = total_vacant.2016/total_HU.2016,
         pctWhite.2016 = total_White.2016/total_pop.2016)

```
```{r}
acsTractsPHL.2020 <- acsTractsPHL.2020 %>%
 mutate(color = if_else(`med_HH_Income.2020` > 33000, "coral2", "gray70"))
```

```{r}

ggplot(acsTractsPHL.2020) + 
  geom_point(aes(x=total_pop.2020,y=acsTractsPHL.2020$med_Income.2020, color = color), size = 3) +
  scale_color_manual(values = c(ifelse(`med_HH_Income.2020` > 33000,"coral2", "gray70")))+ 
  labs(
    title = "2020 Median HH Income vs Population",
    subtitle = "All figures in 2020 dollars",
    caption = "Data: US Census Bureau, ACS 5-year estimates",
    x = "Total Population by Census Tract", fill = "",
    y = "Median Income"
  )+
   theme_sk()+ scale_y_continuous(labels = scales::dollar_format()) + 
  scale_x_continuous(label = scales::comma)+
  geom_hline(yintercept = 33000, linetype = "longdash") 

```

```{r}
ggplot() + 
  geom_point(data = acsTractsPHL.2020, aes(x = `total_pop.2020`, y = `med_HH_Income.2020`, color = color), size = 3) +
  scale_color_manual(values = c(ifelse(`med_HH_Income.2020` > 33000, "coral2", "gray70"))) + 
  labs(
    title = "2020 Median HH Income vs Population",
    subtitle = "All figures in 2020 dollars",
    caption = "Data: US Census Bureau, ACS 5-year estimates",
    x = "Total Population by Census Tract",
    y = "Median Income"
  ) +
  theme_sk() +
  scale_y_continuous(labels = scales::dollar_format()) + 
  scale_x_continuous(labels = scales::comma) +
  geom_hline(yintercept = 33000, linetype = "longdash")

```
```{r}
ggplot(acsTractsPHL.2020) + 
  geom_point(aes(x=`total_pop.2020`,y=`med_HH_Income.2020`, color = color), size = 3) +
  scale_color_manual(
 values = c("coral2" = "coral2", "gray70" = "gray70"))+ 
  labs(
    title = "2020 Median HH Income vs Population",
    subtitle = "All figures in 2020 dollars",
    caption = "Data: US Census Bureau, ACS 5-year estimates",
    x = "Total Population by Census Tract", fill = "",
    y = "Median Income"
  )+
   theme_sk()+ scale_y_continuous(labels = scales::dollar_format()) + 
  scale_x_continuous(label = scales::comma)+
  geom_hline(yintercept = 33000, linetype = "longdash") 
```



```{r}
# making data for UCD

myTracts <- c("42101036901", 
              "42101036902", 
              "42101008801", 
              "42101008802")

acsTractsPHL.2020 <- acsTractsPHL.2020 %>%
  mutate(UCD = ifelse(GEOID %in% myTracts, "University City", "Philadelphia"))

```

```{r}
ggplot(acsTractsPHL.2020)+
  geom_histogram(aes(med_HH_Income.2020),
                 binwidth = 5000, fill = "grey70")+
  labs(
    title = "Philadelphia Median Income by Census Tract, 2020",
     subtitle = "All figures in 2020 dollars",
    caption = "Data: US Census Bureau, ACS 5-year estimates",
    x="Median Income", 
       y="Number of tracts")+
  theme_sk()
```






```{r}

grob_explanation <- grobTree(richtext_grob(
  "<span style='background-color:white'><b>Poverty is defined at $33,000 </b><br><b>median income annually.</b><br>The data illustrates a disparity across the<br>UCD census tracts, with some above the<br>poverty limit and some below.</span>", 
  x=.41,  y=0.3, hjust=0, gp=gpar(col = "grey30", fontsize=11), box_gp = gpar(col = "white", fill = "white"),
  padding = margin(.4,0,0,0,"in")))

ggplot(acsTractsPHL.2020) +
  geom_point(aes(
    x = med_HH_Income.2020,
    y = pctWhite.2020,
    color = UCD
  )) +
  geom_vline(xintercept = 33000, linetype = "longdash", linewidth = 0.5, color = "black") +
  labs(
    title = "2020 Median HH Income vs Percentage White Residents",
    subtitle = "All figures in 2020 dollars",
    caption = "Data: US Census Bureau, ACS 5-year estimates",
    x = "Med HH Income 2020 ($)",
    y = "Percentage White Population"
  ) +
  annotation_custom(grob_explanation) +
  theme_sk() +
  scale_color_manual(
    values = c("University City" = "coral2", "Philadelphia" = "grey70")  # Specify custom colors for UCD and Philadelphia
  )
```

```{r}

#grob_explanation <- grobTree(richtext_grob(
#  "<span style='background-color:white'><b>Poverty is defined at $33,000 </b><br><b>median income annually.</b><br>The data #illustrates a disparity across the<br>UCD census tracts, with some above the<br>poverty limit and some below.</span>", 
#  x=.41,  y=0.3, hjust=0, gp=gpar(col = "grey30", fontsize=11), box_gp = gpar(col = "white", fill = "white"),
#  padding = margin(.4,0,0,0,"in")))

ggplot(acsTractsPHL.2020) +
  geom_point(aes(
    x = med_HH_Income.2020,
    y = total_GradDeg.2020,
    color = UCD
  )) +
  geom_vline(xintercept = 33000, linetype = "longdash", linewidth = 0.5, color = "black") +
  labs(
    title = "2020 Median HH Income vs Graduate Degree Holders",
    subtitle = "All figures in 2020 dollars",
    caption = "Data: US Census Bureau, ACS 5-year estimates",
    x = "Med HH Income 2020 ($)",
    y = "Number of Graduate Degree Holders"
  ) +
 # annotation_custom(grob_explanation) +
  theme_sk() +
  scale_color_manual(
    values = c("University City" = "coral2", "Philadelphia" = "grey70")  # Specify custom colors for UCD and Philadelphia
  )
```








5. Upload your RProject to a GitHub Repo.
